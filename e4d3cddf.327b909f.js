(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{112:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return a})),t.d(n,"metadata",(function(){return c})),t.d(n,"rightToc",(function(){return i})),t.d(n,"default",(function(){return l}));var o=t(1),r=(t(0),t(117));const a={id:"best-practices",title:"Best Practices",sidebar_label:"Best Practices"},c={id:"best-practices",title:"Best Practices",description:"## Don't use static symbols",source:"@site/docs/best-practices.md",permalink:"/ng-vacuum/docs/best-practices",editUrl:"https://github.com/hmil/ng-vacuum/edit/master/docs/docs/best-practices.md",sidebar_label:"Best Practices",sidebar:"someSidebar",previous:{title:"Test a Component",permalink:"/ng-vacuum/docs/component-test"},next:{title:"Using Injection Tokens",permalink:"/ng-vacuum/docs/injection-tokens"}},i=[{value:"Don&#39;t use static symbols",id:"dont-use-static-symbols",children:[]},{value:"Catch unhandled errors",id:"catch-unhandled-errors",children:[]},{value:"Use page objects",id:"use-page-objects",children:[]}],s={rightToc:i};function l({components:e,...n}){return Object(r.b)("wrapper",Object(o.a)({},s,n,{components:e,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"dont-use-static-symbols"},"Don't use static symbols"),Object(r.b)("p",null,"Your code should never borrow symbols from the outer scope of the module. This includes obvious browser APIs like ",Object(r.b)("inlineCode",{parentName:"p"},"window"),", ",Object(r.b)("inlineCode",{parentName:"p"},"console"),", ",Object(r.b)("inlineCode",{parentName:"p"},"document"),", but also imported functions and static class functions (including the ",Object(r.b)("inlineCode",{parentName:"p"},"new")," operator)."),Object(r.b)("p",null,"All such symbols must be provided to the class via dependency injection. Following are a couple of examples to illustrate this principle."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-ts"}),"// foo.service.ts\n@Injectable()\nexport class FooService {\n\n    public onSomething() {\n        history.back(); // No: Don't use a global API like that.\n    }\n}\n")),Object(r.b)("p",null,"Instead, inject the symbol. For instance, you could just inject the ",Object(r.b)("inlineCode",{parentName:"p"},"Window")," object in here."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-ts"}),"// foo.service.ts\nexport const WINDOW = new InjectionToken<Window>('WINDOW');\n\n@Injectable()\nexport class FooService {\n\n    constructor(@Inject(WINDOW) private readonly window: Window) { }\n\n    public onSomething() {\n        this.window.history.back(); // OK: This can easily be mocked\n    }\n}\n\n\n// app.module.ts\nimport { WINDOW } from 'foo.service.ts';\n\n@NgModule({\n    // ...\n    providers: [\n        {provide: WINDOW, useValue: window }\n    ]\n})\n")),Object(r.b)("p",null,"See ",Object(r.b)("a",Object(o.a)({parentName:"p"},{href:"./injection-tokens"}),"using injection tokens")," for more info."),Object(r.b)("p",null,"Another example is class constructors. Class constructors are static methods and cannot easilly be mocked with ng-vacuum (and in general too). Unless the class you are constructing is a simple data object like ",Object(r.b)("inlineCode",{parentName:"p"},"Point(x,y)"),", ",Object(r.b)("inlineCode",{parentName:"p"},"Rect(x,y,w,h)")," or similar, you will want to uncouple the code using this class with a factory service."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-ts"}),"// action-factory.service.ts\n@Injectable()\nexport class ActionFactoryService {\n    \n    public createCopyAction(...args: ConstructorParameters<CopyAction>) {\n        return new CopyAction(...args);\n    }\n}\n\n\n// action-manager.service.ts\n@Injectable()\nexport class ActionManagerService {\n    constructor(private readonly actionFactory: ActionFactoryService) { }\n\n    public onCopy(data: string) {\n        // Good: use of a factory decouples the code an makes it easy to test\n        // as opposed to code which calls `new CopyAction` directly.\n        const action = actionFactory.createCopyAction(data);\n        this.dispatch(action);\n    }\n}\n")),Object(r.b)("h2",{id:"catch-unhandled-errors"},"Catch unhandled errors"),Object(r.b)("p",null,"By default, jasmine ignores uncaught errors during a test. This can lead to unexpected behavior and silent errors."),Object(r.b)("p",null,"NgVacuum provides a utility you can call during test setup to prevent errors from escaping your test."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-ts"}),"import { catchUnandledErrors } from 'ng-vacuum';\n\n// Call this in your test environment setup file (typically src/test.ts)\ncatchUnhandledErrors();\n")),Object(r.b)("h2",{id:"use-page-objects"},"Use page objects"),Object(r.b)("p",null,"Abstract away CSS selectors in a page object. This makes tests more readable but also makes it easier to update the test suite after the component template was changed."),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-ts"}),"describe('SomeComponent', () => {\n    \n    let rendering: Rendering<SomeComponent, unknown>;\n\n    beforeEach(async () => {\n        rendering = await renderComponent(SomeComponent, AppModule);\n    });\n\n    it('can click a button', () => {\n        // Bad: This test is not readable\n        rendering.findComponent(MyButton).click.emit();\n        expect((rendering.find('[test-id=the-input]').nativeElement as HTMLInputElement).value).toBe('OK');\n    });\n});\n")),Object(r.b)("pre",null,Object(r.b)("code",Object(o.a)({parentName:"pre"},{className:"language-ts"}),"describe('SomeComponent', () => {\n\n    let page: Page;\n    \n    beforeEach(async () => {\n        page = new Page(await renderComponent(SomeComponent, AppModule));\n    });\n\n    it('can click a button', () => {\n        // Bad: This test is not readable\n        page.submitButton.click.emit();\n        expect(page.textInput.value).toBe('OK');\n    });\n});\n\nclass Page extends BasePage<SomeComponent> {\n\n    get submitButton() {\n        return this.rendering.findComponent(MyButton);\n    }\n\n    get textInput(): HTMLInputElement {\n        return this.rendering.find('[test-id=the-input]').nativeElement;\n    }\n}\n")))}l.isMDXComponent=!0},117:function(e,n,t){"use strict";t.d(n,"a",(function(){return u})),t.d(n,"b",(function(){return m}));var o=t(0),r=t.n(o);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function c(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?c(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):c(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=r.a.createContext({}),p=function(e){var n=r.a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i({},n,{},e)),t},u=function(e){var n=p(e.components);return r.a.createElement(l.Provider,{value:n},e.children)},b={inlineCode:"code",wrapper:function(e){var n=e.children;return r.a.createElement(r.a.Fragment,{},n)}},d=Object(o.forwardRef)((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),u=p(t),d=o,m=u["".concat(c,".").concat(d)]||u[d]||b[d]||a;return t?r.a.createElement(m,i({ref:n},l,{components:t})):r.a.createElement(m,i({ref:n},l))}));function m(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,c=new Array(a);c[0]=d;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:o,c[1]=i;for(var l=2;l<a;l++)c[l]=t[l];return r.a.createElement.apply(null,c)}return r.a.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);